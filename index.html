<!DOCTYPE html>
<html lang="mr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anik Financial Pro-App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background: #f3f4f6; font-family: 'Inter', sans-serif; }
        .card { background: white; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .input-box { width: 100%; border: 1.5px solid #e2e8f0; padding: 10px; border-radius: 10px; font-size: 14px; outline: none; }
        .input-box:focus { border-color: #0046ad; }
        .table-input { width: 80px; border-bottom: 2px solid #e2e8f0; text-align: center; font-weight: bold; }
        .section-header { background: #0046ad; color: white; padding: 10px; border-radius: 10px; font-size: 12px; font-weight: bold; margin-bottom: 15px; text-transform: uppercase; }
        #app-loader { position: fixed; inset: 0; background: white; z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: 0.4s; }
    </style>
</head>
<body>

    <!-- Fast Loader -->
    <div id="app-loader">
        <img src="https://anikfin.com/wp-content/uploads/2024/06/anik-horizontal-1-1024x400.png" class="h-16 mb-4 animate-pulse">
        <div class="h-1 w-48 bg-gray-100 rounded-full overflow-hidden"><div class="h-full bg-blue-600 animate-[load_1.5s_ease-in-out_infinite]" style="width: 30%"></div></div>
    </div>

    <div class="max-w-xl mx-auto p-4">
        <!-- Logo -->
        <div class="text-center my-6">
            <img src="https://anikfin.com/wp-content/uploads/2024/06/anik-horizontal-1-1024x400.png" class="h-12 mx-auto">
        </div>

        <!-- SELECTION CARD -->
        <div id="selection-card" class="card p-6 space-y-4">
            <div>
                <label class="text-[10px] font-bold text-gray-400">आपले युनिट निवडा</label>
                <select id="unitSelect" onchange="filterNames()" class="input-box"></select>
            </div>
            <div id="nameDiv" class="hidden">
                <label class="text-[10px] font-bold text-gray-400">आपले नांव निवडा</label>
                <select id="nameSelect" onchange="startReporting()" class="input-box"></select>
            </div>
        </div>

        <!-- MAIN REPORTING FORM -->
        <form id="reportingForm" class="hidden mt-6 pb-20">
            <div class="card p-6 space-y-6">
                <div class="flex justify-between items-center border-b pb-4">
                    <h2 id="roleTitle" class="font-black text-blue-900 uppercase italic">Reporting</h2>
                    <input type="date" name="ReportDate" id="currentDate" class="text-xs font-bold border-none outline-none">
                </div>

                <div id="dynamicSections"></div>

                <button type="submit" id="submitBtn" class="w-full bg-[#0046ad] text-white font-bold py-4 rounded-2xl shadow-lg uppercase tracking-widest text-sm">
                    Submit Final Report
                </button>
            </div>
        </form>
    </div>

    <script>
        const scriptURL = 'येथे_तुमची_URL_टाका';
        let apiData = {};
        let currentUser = {};

        window.onload = async () => {
            const res = await fetch(scriptURL);
            apiData = await res.json();
            const units = [...new Set(apiData.staff.map(s => s.unit))];
            const unitSelect = document.getElementById('unitSelect');
            unitSelect.innerHTML = '<option value="">-- निवडा --</option>' + units.map(u => `<option value="${u}">${u}</option>`).join('');
            document.getElementById('app-loader').style.opacity = '0';
            setTimeout(() => document.getElementById('app-loader').style.display = 'none', 500);
            document.getElementById('currentDate').valueAsDate = new Date();
        };

        function filterNames() {
            const unit = document.getElementById('unitSelect').value;
            const nameSelect = document.getElementById('nameSelect');
            if(!unit) return document.getElementById('nameDiv').classList.add('hidden');
            const filtered = apiData.staff.filter(s => s.unit === unit);
            nameSelect.innerHTML = '<option value="">-- निवडा --</option>' + filtered.map(s => `<option value="${s.id}">${s.name} (${s.role})</option>`).join('');
            document.getElementById('nameDiv').classList.remove('hidden');
        }

        function startReporting() {
            const userId = document.getElementById('nameSelect').value;
            currentUser = apiData.staff.find(s => s.id == userId);
            document.getElementById('roleTitle').innerText = `${currentUser.role} REPORT`;
            document.getElementById('reportingForm').classList.remove('hidden');
            renderRoleForm(currentUser.role);
        }

        function renderRoleForm(role) {
            const container = document.getElementById('dynamicSections');
            container.innerHTML = '';

            if(role === 'FX') {
                container.innerHTML = `
                    <div class="section-header">आजचे एकुण कलेक्शन (Regular + OD)</div>
                    <table class="w-full text-[10px]">
                        <tr class="text-gray-400 font-bold border-b"><td>सी ऐ नांव</td><td>खाते</td><td>रक्कम</td></tr>
                        ${currentUser.assignedCAs.map(ca => `
                            <tr class="border-b"><td class="py-2">${ca}</td>
                            <td><input type="number" name="Coll_Qty_${ca}" class="table-input" oninput="calcFX()"></td>
                            <td><input type="number" name="Coll_Amt_${ca}" class="table-input fx-amt" oninput="calcFX()"></td></tr>
                        `).join('')}
                        <tr class="font-bold text-blue-800"><td>एकूण</td><td id="fx-total-qty">0</td><td id="fx-total-amt">0</td></tr>
                    </table>

                    <div class="section-header mt-8">सी ऐ निहाय किती रक्कम कॅश / डिजीटल आली</div>
                    ${currentUser.assignedCAs.map(ca => `
                        <div class="grid grid-cols-3 gap-2 mb-2 items-center">
                            <span class="text-[10px] font-bold">${ca}</span>
                            <input type="number" name="Cash_${ca}" placeholder="Cash" class="input-box py-1 text-xs">
                            <input type="number" name="Digital_${ca}" placeholder="Digital" class="input-box py-1 text-xs">
                        </div>
                    `).join('')}

                    <div class="section-header mt-8">हातावर शिल्लक (Discipline)</div>
                    ${currentUser.assignedCAs.map(ca => `
                        <div class="grid grid-cols-2 gap-2 mb-2">
                            <span class="text-[10px] font-bold">${ca}</span>
                            <input type="number" name="Hand_Cash_${ca}" placeholder="शिल्लक रक्कम" class="input-box py-1 text-xs">
                        </div>
                    `).join('')}
                    <textarea name="Cash_Reason" placeholder="हातावर शिल्लक राहण्याचे कारण लिहा..." class="input-box mt-2 h-16"></textarea>

                    <div class="section-header mt-8">Portfolio & Interactions</div>
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="text-[9px]">Visited Today</label><input type="number" name="Visited" class="input-box"></div>
                        <div><label class="text-[9px]">Not Paid</label><input type="number" name="NotPaid" class="input-box"></div>
                    </div>
                    <textarea name="Complaints" placeholder="काही ग्राहकांच्या तक्रारी होत्या का?..." class="input-box h-16"></textarea>
                `;
            } else if(role === 'BM') {
                container.innerHTML = `
                    <div class="section-header">आजचे शाखेचे एकुण कलेक्शन</div>
                    <div class="grid grid-cols-2 gap-4">
                        <input type="number" name="Total_Cust" placeholder="एकूण ग्राहक" class="input-box">
                        <input type="number" name="Total_Amt" placeholder="रक्कम" class="input-box">
                    </div>
                    <div class="section-header mt-6">ओडी स्थिती (Buckets)</div>
                    <div class="space-y-3">
                        <div class="flex gap-2"><span class="w-20 text-[10px] font-bold">1-30 Days</span><input type="number" name="PAR1_Qty" placeholder="Qty" class="input-box"><input type="number" name="PAR1_Amt" placeholder="Amt" class="input-box"></div>
                        <div class="flex gap-2"><span class="w-20 text-[10px] font-bold">31-90 Days</span><input type="number" name="PAR2_Qty" placeholder="Qty" class="input-box"><input type="number" name="PAR2_Amt" placeholder="Amt" class="input-box"></div>
                        <div class="flex gap-2"><span class="w-20 text-[10px] font-bold">91+ Days</span><input type="number" name="PAR3_Qty" placeholder="Qty" class="input-box"><input type="number" name="PAR3_Amt" placeholder="Amt" class="input-box"></div>
                    </div>
                    <div class="section-header mt-6">वाटप (Disbursement)</div>
                    <div class="grid grid-cols-2 gap-4">
                        <input type="number" name="Disb_Qty" placeholder="ग्राहक संख्या" class="input-box">
                        <input type="number" name="Disb_Amt" placeholder="रक्कम" class="input-box">
                    </div>
                `;
            } else if(role === 'CA') {
                container.innerHTML = `
                    <div class="section-header">कलेक्शन रिपोर्ट</div>
                    <div class="grid grid-cols-2 gap-2 mb-4">
                        <label class="text-[9px] col-span-2 font-bold">Reg. Collection</label>
                        <input type="number" name="Reg_Qty" placeholder="ग्राहक" class="input-box">
                        <input type="number" name="Reg_Amt" placeholder="रक्कम" class="input-box">
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <label class="text-[9px] col-span-2 font-bold">OD Collection</label>
                        <input type="number" name="OD_Qty" placeholder="ग्राहक" class="input-box">
                        <input type="number" name="OD_Amt" placeholder="रक्कम" class="input-box">
                    </div>
                    <div class="section-header mt-6">फील्ड ॲक्टिव्हिटी</div>
                    <div class="grid grid-cols-2 gap-4">
                        <input type="number" name="Meetings" placeholder="गट बैठका" class="input-box">
                        <input type="number" name="NewGroups" placeholder="नवीन गट" class="input-box">
                        <input type="number" name="Forms" placeholder="फॉर्म भरले" class="input-box">
                        <input type="number" name="Digital" placeholder="डिजीटल जोडले" class="input-box">
                    </div>
                `;
            }
        }

        function calcFX() {
            let totalQty = 0, totalAmt = 0;
            document.querySelectorAll('input[name^="Coll_Qty_"]').forEach(i => totalQty += Number(i.value) || 0);
            document.querySelectorAll('input[name^="Coll_Amt_"]').forEach(i => totalAmt += Number(i.value) || 0);
            document.getElementById('fx-total-qty').innerText = totalQty;
            document.getElementById('fx-total-amt').innerText = totalAmt;
        }

        document.getElementById('reportingForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('submitBtn');
            btn.disabled = true; btn.innerText = "Syncing with Anik Server...";
            
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());
            data.Role = currentUser.role;
            data.StaffName = currentUser.name;
            data.Unit = currentUser.unit;

            try {
                await fetch(scriptURL, { method: 'POST', body: JSON.stringify(data) });
                alert("Data Sent Successfully!");
                location.reload();
            } catch(e) { alert("Error connecting to server!"); btn.disabled = false; }
        });
    </script>
</body>
</html>
